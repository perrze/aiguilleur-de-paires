<!DOCTYPE html>
<html>
<head>
    <title>Aiguilleur de paires</title>
    <link rel='icon' type='image/x-icon' href='/sources/logo/PetitLogo.ico'>
    <link href="/css/boosted/boosted.min.css" rel="stylesheet">
    <!-- <script src="/js/main.js"></script> -->
    <script src="/js/jquery-3.6.4.min.js"></script>
    <!-- <script src="/js/bootstrap/popper.min.js"></script> -->
    <script src="/js/boosted/boosted.bundle.min.js"></script>
    <!-- <script src="/js/js.cookie.min.js"></script> -->
</head>

<body>
    <header>
        <nav class="navbar navbar-dark bg-dark navbar-expand-lg" aria-label="Global navigation - Standard example">
            <div class="container-xxl">
                <!-- Orange brand logo -->
                <div class="navbar-brand me-auto me-lg-4">
                    <a class="stretched-link" href="#">
                        <img src="/sources/brand/orange-logo.svg" width="50" height="50" alt="Boosted - Back to Home"
                            loading="lazy">
                    </a>
                    <h1 class="two-lined">
                        Orange
                        <br>
                        UI NC - EQ MA LHA
                    </h1>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <script>
            function refreshSM() {

                // console.log("list");
                // if (true) {
                $.ajax({
                    type: 'GET',
                    url: 'http://api.adp.bb0.fr/switchmans',
                    processData: false,
                    contentType: false,
                    statusCode : {
                        200: function (response) {
                            console.log(response);
                            option = "<option selected>Choisir l'aiguilleur</option>";
                            if (response[0].id == "List Empty") {
                                $("#result").html("Pas d'aiguilleurs disponible");
                                $("#result-div").addClass("border-danger");
                                $("#result-div").removeClass("border-success");
                            } else {
                                $("#result").html(response)
                                $("#result-div").removeClass("border-danger");
                                $("#result-div").addClass("border-success");
                                for (i = 0; i < response.length; i++) {
                                    option += "<option value='" + response[i].id + "'>" + response[i].id + "</option>";
                                }
                                $('#select-sm').html(option);
    
                            }
                        }
                    }
                        
                });

            }
            function sendCommand(command) {
                var id = $("#select-sm").val();
                var data = {"id" : id, "pair":command}


                console.log(data);
                $.ajax({
                    type: 'POST',
                    url: 'http://api.adp.bb0.fr/switchmans/send',
                    data: JSON.stringify(data),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    processData: false,
                    contentType: false,
                    200: function (response) {
                        console.log(response);
                        if ((response.pair)[0] == "P") {
                            $("#result").html("Résultat : Aiguilleur sur: " + response.pair);
                        }
                        else {
                            $("#result").html("Résultat : Aiguilleur en: " + response.pair);
                        }
                        $("#result-div").removeClass("border-danger");
                        $("#result-div").addClass("border-success");
                      },
                      400: function(xhr) {
                        $("#result").html("Résultat : Erreur, Mauvais formattage JSON");
                        $("#result-div").addClass("border-danger");
                        $("#result-div").removeClass("border-success");
                      },
                      404: function (xhr) {
                        $("#result").html("Résultat : Erreur, Mauvais formattage JSON");
                        $("#result-div").addClass("border-danger");
                        $("#result-div").removeClass("border-success");
                    }

                });


            }

        </script>

        <div class="container my-4">
            <h2 class="my-4">Contrôler vos aiguilleurs</h2>
            <div id="forms mx-2">
                <div id="select-sm-div" class="row">
                    <div class="col-lg-9">
                        <select id="select-sm" class="form-select" aria-label="Select Switchman">
                            <option>Choisir l'aiguilleur</option>
                        </select>
                    </div>
                    <div class="col-lg-3">
                        <button type="submit" class="btn btn-primary mb-3 col form-control"
                            onclick="refreshSM()">Actualiser</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <button id="P1" onclick="sendCommand('P1')" type="submit"
                            class="btn btn-secondary mb-3 col form-control">Paire 1</button>
                    </div>
                    <div class="col-lg-3">
                        <button id="P2" onclick="sendCommand('P2')" type="submit"
                            class="btn btn-success mb-3 col form-control">Paire 2</button>
                    </div>
                    <div class="col-lg-3">
                        <button id="P3" onclick="sendCommand('P3')" type="submit"
                            class="btn btn-danger mb-3 col form-control">Paire 3</button>
                    </div>
                    <div class="col-lg-3">
                        <button id="P4" onclick="sendCommand('P4')" type="submit"
                            class="btn btn-info mb-3 col form-control">Paire 4</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button id="CC" onclick="sendCommand('CC')" type="submit"
                            class="btn btn-primary mb-3 col form-control">Boucle</button>
                    </div>
                    <div class="col">
                        <button id="BO" onclick="sendCommand('BO')" type="submit"
                            class="btn btn-primary mb-3 col form-control">Ouvert</button>
                    </div>
                </div>
                <div id="result-div" class="container border">
                    <p id="result" class="p-1 mx-1"></p>
                </div>
            </div>
        </div>
    </main>


</body>

</html>